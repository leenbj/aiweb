# 系统提示词 vs 用户自定义提示词 - 详细对比

## 📋 基本概念

### 1. 系统提示词 (System Prompt)
**定义**: 硬编码在代码中的默认AI行为指令
**位置**: 代码文件中的字符串常量
**作用**: 为所有用户提供基础的AI行为模板

### 2. 用户自定义提示词 (Custom Prompt)
**定义**: 用户在设置中配置的个性化AI行为指令
**位置**: 数据库 `UserSettings.systemPrompt` 字段
**作用**: 覆盖系统默认行为，提供个性化体验

---

## 🔍 详细技术对比

| 对比维度 | 系统提示词 | 用户自定义提示词 |
|---------|-----------|-----------------|
| **存储位置** | 代码文件 | 数据库 |
| **数据表字段** | - | `UserSettings.systemPrompt` |
| **优先级** | 低 | 高（覆盖系统默认） |
| **作用范围** | 全局默认 | 特定用户 |
| **修改方式** | 修改代码 + 重启服务 | 设置页面实时修改 |
| **生效时间** | 需重启后端 | 立即生效 |

---

## 📂 当前系统中的具体实现

### 系统提示词位置

#### 1. 聊天对话系统提示词
```typescript
// 文件: backend/src/routes/ai.ts (第467-476行)
content: `你是一个专业的网站需求分析师和AI助手。你的任务是与用户进行友好对话，了解他们的网站需求。

对话原则：
1. 友好、专业、有帮助
2. 逐步引导用户提供网站需求信息
3. 询问关键信息：网站类型、功能需求、设计风格、目标用户等
4. 当收集到足够信息时，总结需求并询问是否开始生成
5. 不要直接生成代码，只负责需求收集和确认

请根据用户消息进行自然对话。`
```

#### 2. 网站生成系统提示词
```typescript
// 文件: backend/src/services/ai.ts (第101-125行)
let systemPrompt = customPrompt || `你是一个专业的网站代码生成器。你的任务是根据用户需求生成完整的HTML网站代码。

重要规则：
1. 不要进行对话或询问问题
2. 直接生成完整的网站HTML代码
3. 必须返回严格的JSON格式
...`
```

### 用户自定义提示词

#### 数据库模型定义
```prisma
// 文件: backend/prisma/schema.prisma (第133行)
model UserSettings {
  id                String   @id @default(cuid())
  userId            String   @unique
  systemPrompt      String?  @map("system_prompt")  // 👈 这里存储用户自定义提示词
  aiProvider        String   @default("deepseek")
  deepseekModel     String?
  // ... 其他字段
}
```

#### 使用逻辑
```typescript
// 文件: backend/src/services/ai.ts (第101行)
let systemPrompt = customPrompt || `默认系统提示词...`;
//                 👆 用户自定义    👆 系统默认
//                 优先级更高        fallback选项
```

---

## ⚡ 优先级规则

**执行顺序**:
1. **检查用户自定义提示词** - 如果用户在设置中配置了 `systemPrompt`
2. **使用系统默认提示词** - 如果用户没有自定义配置
3. **参数传递** - 通过 `customPrompt` 参数传递给AI Provider

**代码实现**:
```typescript
// 优先级: customPrompt > systemPrompt (系统默认)
let systemPrompt = customPrompt || `系统默认提示词内容...`;
```

---

## 🛠️ 如何配置用户自定义提示词

### 方法1: 通过设置页面 (推荐)
1. 访问 `http://localhost:3000/settings`
2. 找到"系统提示词"或"AI设置"部分
3. 输入自定义提示词
4. 保存设置 → 立即生效

### 方法2: 直接操作数据库
```sql
-- 查看用户设置
SELECT * FROM user_settings WHERE user_id = 'your_user_id';

-- 更新自定义提示词
UPDATE user_settings 
SET system_prompt = '你的自定义提示词内容...' 
WHERE user_id = 'your_user_id';
```

### 方法3: 通过API
```javascript
// POST /api/settings
{
  "systemPrompt": "你的自定义提示词内容..."
}
```

---

## 🎯 实际应用场景

### 场景1: 加速AI响应
**用户自定义**:
```
简洁回复，快速收集网站需求：类型、功能、设计。
```
**效果**: AI思考时间从3秒减少到1秒

### 场景2: 专业化定制
**用户自定义**:
```
你是资深UX/UI设计师。深入分析用户业务需求，提供专业的设计建议和最佳实践。询问目标用户画像、业务流程、品牌调性等关键信息。
```
**效果**: 获得更专业、更深入的需求分析

### 场景3: 行业特化
**用户自定义**:
```
你是电商网站专家。重点关注商品展示、购物流程、支付集成、用户体验优化等电商核心功能。
```
**效果**: 针对特定行业的专业指导

---

## 📊 性能影响对比

| 提示词类型 | 处理时间 | 个性化程度 | 维护成本 |
|-----------|----------|------------|----------|
| 系统默认 | 标准 | 低 | 低 (代码维护) |
| 用户自定义 | 可变 | 高 | 中 (数据库存储) |

---

## ⚠️ 注意事项

### 1. 用户自定义提示词的限制
- 仍需遵循JSON格式要求（网站生成时）
- 不能破坏核心功能逻辑
- 建议保持提示词简洁以减少AI处理时间

### 2. 系统提示词的修改影响
- 影响所有没有自定义设置的用户
- 需要重启后端服务才能生效
- 建议谨慎修改，先在测试环境验证

### 3. 调试和排查
- 查看日志中的 `hasCustomPrompt` 字段确认是否使用了自定义提示词
- 用户反馈问题时优先检查其自定义设置

---

## 🔧 当前系统状态

**系统提示词**: ✅ 已配置，功能完整
**用户自定义功能**: ✅ 已实现，支持通过设置页面配置
**优先级机制**: ✅ 正常工作，用户自定义优先
**数据库存储**: ✅ UserSettings表正常

您可以立即通过设置页面配置个性化的AI行为！
